var ks_com_sociallogin={popup:undefined,fakeOncloseEvent:undefined,provider:undefined,destination:undefined,init:function(){this.bind_ui_actions();},bind_ui_actions:function(){$j('body').on('click','.sociallogin',ks_com_sociallogin.click_sociallogin);},click_sociallogin:function(e){e.stopPropagation();ks_com_sociallogin.provider=$j(this).attr('data-provider');ks_com_sociallogin.open_login_popup($j(this).attr('href'));return false;},update_sociallogin_status:function(content,type){$j('.sociallogin-status').html(content);},open_login_popup:function(url){this.popup=open_popup(url,'Social Login');if(this.popup==null||typeof(this.popup)=='undefined'){return false;}else{this.popup.focus();this.fakeOncloseEvent=window.setInterval(function(){if(ks_com_sociallogin.popup){if(!ks_com_sociallogin.popup.parent){window.clearInterval(ks_com_sociallogin.fakeOncloseEvent);ks_com_sociallogin.update_sociallogin_status('Seems like it didn\'t work!');}}},500);ks_com_sociallogin.register_message_listener();}
return true;},register_message_listener:function(){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";var eventer=window[eventMethod];var messageEvent=eventMethod=="attachEvent"?"onmessage":"message";eventer(messageEvent,function(e){console.log("parent received message!:  ");console.log(e.data);window.clearInterval(ks_com_sociallogin.fakeOncloseEvent);switch(e.data.status){case 'success':var destination=$j("input[name=\'destination\']").val();var query=Array();var pos=$j("input[name=\'pos\']").val();if(pos!==undefined){query.push('pos='+pos);}
if(destination){window.location='/'+destination+'?'+query.join('&');}else{var newPath=e.data.redirect_path;if(newPath){window.location.pathname=destination?destination:newPath;}else{var pages=new Array('/signup','/login');if(pages.indexOf(window.location.pathname)!=-1){window.location.pathname='/';}else if(window.location.pathname="/signup/create/publiclibrary"){window.location.pathname='/signup/welcome';}else{window.location.reload();}}}
if(ks_com_sociallogin.popup!=undefined){ks_com_sociallogin.popup.close();}
break;default:ks_com_sociallogin.update_sociallogin_status('Hum... Something went wrong...');break;}},false);console.log('PostMessage listener ready');}};$j(document).on("ready",function(){ks_com_sociallogin.init();});