function open_modal(target,reason){$target=$j(target);$j('.header',$target).text(reason);$target.modal("setting","autofocus",true).modal('show');$j('.close.icon',$target).click(function(){$target.modal('hide');});$j('.tthover',$target).popup({hoverable:true,variation:'inverted'});return false;}
$j(document).on("ready",function(){$j('body').on('click','.open-modal',function(e){e.stopPropagation();$this=$j(this);target=$this.attr('data-target');reason=$this.attr('data-reason');open_modal(target,reason);trapFocusModal($target);return false;});$j('body').on('submit','form.login-ajax',function(){$form=$j(this);name=$j("input[name=\'name\']",$form).val();pass=$j("input[name=\'pass\']",$form).val();destination=$j("input[name=\'destination\']",$form).val();pos=$j("input[name=\'pos\']",$form).val();$name_status_el=$j(".ajax-status.name",$form);$pass_status_el=$j(".ajax-status.pass",$form);$submit_btn=$j("input[type=\'submit\']",$form);$.ajax({url:"/user/login-ajax-submit",type:"POST",data:{name:name,pass:pass,destination:destination,pos:pos},dataType:"json",beforeSend:function(){$name_status_el.transition("hide");$pass_status_el.transition("hide");$j("#edit-name").removeClass("error-border-red");$j("#edit-pass").removeClass("error-border-red");$submit_btn.addClass('loading');},success:function(data){if(data.status){$form.slideUp(function(){$j("#success-loading").prepend(data.msg).slideDown(function(){if(data.destination){document.location.href=data.destination;}else{document.location.href='/';}});});}else{if(data.msg_name){$name_status_el.html(data.msg_name);$name_status_el.transition("fade in");$j("#edit-name").addClass("error-border-red");}
if(data.msg_pass){$pass_status_el.html(data.msg_pass);$pass_status_el.transition("fade in");$j("#edit-pass").addClass("error-border-red");}}
$submit_btn.removeClass('loading');},error:function(xhr){if(xhr.status===429){$pass_status_el.html("Too many failed attempts. Please try again in 10 minutes.");}else{$pass_status_el.html("Something went wrong");}
$pass_status_el.transition("fade in");$submit_btn.removeClass('loading');}});return false;});});